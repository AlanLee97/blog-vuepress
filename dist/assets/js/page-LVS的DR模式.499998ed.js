(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{1018:function(s,a,t){"use strict";t.r(a);var n=t(1),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"lvs的dr模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lvs的dr模式"}},[s._v("#")]),s._v(" LVS的DR模式")]),s._v(" "),t("h2",{attrs:{id:"准备资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备资源"}},[s._v("#")]),s._v(" 准备资源")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("主机")]),s._v(" "),t("th",[s._v("ip")]),s._v(" "),t("th",[s._v("角色")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("master")]),s._v(" "),t("td",[s._v("192.168.1.20")]),s._v(" "),t("td",[s._v("DR")])]),s._v(" "),t("tr",[t("td",[s._v("node1")]),s._v(" "),t("td",[s._v("192.168.1.21")]),s._v(" "),t("td",[s._v("RS1")])]),s._v(" "),t("tr",[t("td",[s._v("node2")]),s._v(" "),t("td",[s._v("192.168.1.22")]),s._v(" "),t("td",[s._v("RS2")])])])]),s._v(" "),t("h2",{attrs:{id:"搭建步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建步骤"}},[s._v("#")]),s._v(" 搭建步骤")]),s._v(" "),t("p",[s._v("1、 找一台主机作为DR（虚拟服务器），安装ipvsadm")]),s._v(" "),t("p",[s._v("a) Yum install ipvsadm")]),s._v(" "),t("p",[s._v("2、 在DR设置两个IP地址：")]),s._v(" "),t("p",[s._v("a) DIP: 192.168.1.134 ,设置静态ID")]),s._v(" "),t("p",[s._v("b) VIP:192.168.1.200 , ifconfig eth0:1 192.168.1.200/24")]),s._v(" "),t("p",[s._v("3、 找多台机器作为RS( apeche或者tomcat )")]),s._v(" "),t("p",[s._v("a) 两台：静态设置192.168.1.137")]),s._v(" "),t("p",[s._v("​          192.168.1.138")]),s._v(" "),t("p",[s._v("b) 修改报文源IP的设置，需要设置内核参数")]),s._v(" "),t("p",[s._v("i. echo 1 > /proc/sys/net/ipv4/conf/eth0/arp_ignore")]),s._v(" "),t("p",[s._v("ii. echo 1 > /proc/sys/net/ipv4/conf/all/arp_ignore")]),s._v(" "),t("p",[s._v("iii. echo 2 > /proc/sys/net/ipv4/conf/eth0/arp_announce")]),s._v(" "),t("p",[s._v("iv. echo 2 > /proc/sys/net/ipv4/conf/all/arp_announce")]),s._v(" "),t("p",[s._v("c) 在两台机器（RS）上，设置网卡的别名IP：192.168.1.200")]),s._v(" "),t("p",[s._v("i. ifconfig lo:0 192.168.1.200 netmask 255.255.255.255 broadcast 192.168.1.200")]),s._v(" "),t("p",[s._v("d) 在两台机器（RS）上，添加一个路由")]),s._v(" "),t("p",[s._v("i. route add -host 192.168.1.200 dev lo:0")]),s._v(" "),t("p",[s._v("4、 DR上需要加一个路由设置：route add -host 192.168.1.200 dev eth0:1")]),s._v(" "),t("p",[s._v("5、 在RS 检查web服务是否正常")]),s._v(" "),t("p",[s._v("6、 在DR上使用ipvsadm添加集群服务")]),s._v(" "),t("p",[s._v("a) Ipvsadm –C")]),s._v(" "),t("p",[s._v("b) ipvsadm -A -t 192.168.1.200:80 -s wlc")]),s._v(" "),t("p",[s._v("c) ipvsadm -a -t 192.168.1.200:80 -r 192.168.1.137 -g -w 1")]),s._v(" "),t("p",[s._v("d) ipvsadm -a -t 192.168.1.200:80 -r 192.168.1.138 -g -w 1")])])}),[],!1,null,null,null);a.default=e.exports},1030:function(s,a,t){"use strict";t.r(a);var n=t(1),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"lvs的dr模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lvs的dr模式"}},[s._v("#")]),s._v(" LVS的DR模式")]),s._v(" "),t("h2",{attrs:{id:"准备资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备资源"}},[s._v("#")]),s._v(" 准备资源")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("主机")]),s._v(" "),t("th",[s._v("ip")]),s._v(" "),t("th",[s._v("角色")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("master")]),s._v(" "),t("td",[s._v("192.168.1.20")]),s._v(" "),t("td",[s._v("DR")])]),s._v(" "),t("tr",[t("td",[s._v("node1")]),s._v(" "),t("td",[s._v("192.168.1.21")]),s._v(" "),t("td",[s._v("RS1")])]),s._v(" "),t("tr",[t("td",[s._v("node2")]),s._v(" "),t("td",[s._v("192.168.1.22")]),s._v(" "),t("td",[s._v("RS2")])])])]),s._v(" "),t("h2",{attrs:{id:"搭建步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建步骤"}},[s._v("#")]),s._v(" 搭建步骤")]),s._v(" "),t("h3",{attrs:{id:"dr服务器上操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dr服务器上操作"}},[s._v("#")]),s._v(" DR服务器上操作")]),s._v(" "),t("h4",{attrs:{id:"设置临时虚拟ip"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置临时虚拟ip"}},[s._v("#")]),s._v(" 设置临时虚拟IP")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.100/24 dev ens33 label ens33:0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("重启网络服务")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" network restart\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"安装ipvsadm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装ipvsadm"}},[s._v("#")]),s._v(" 安装ipvsadm")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y ipvsadm\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"dr上配置脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dr上配置脚本"}},[s._v("#")]),s._v(" DR上配置脚本")]),s._v(" "),t("p",[s._v("编写脚本")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/sbin/lvs_dr.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("lvs_dr.sh")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#! /bin/bash")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/ipv4/ip_forward\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ipv")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/sbin/ipvsadm\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vip")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.100\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rs1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.21\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rs2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.22\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置ds的ip和路由，也可以先手动设置好")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" ens33:0 down\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" ens33:0 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vip")]),s._v(" broadcast "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vip")]),s._v(" netmask "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.255 up\n\nroute "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" -host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vip")]),s._v(" dev ens33:0\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ipv")]),s._v(" -C\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ipv")]),s._v(" -A -t "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vip")]),s._v(":80 -s wlc\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ipv")]),s._v(" -a -t "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vip")]),s._v(":80 -r "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rs1")]),s._v(":80 -g -w "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ipv")]),s._v(" -a -t "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vip")]),s._v(":80 -r "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rs2")]),s._v(":80 -g -w "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("p",[s._v("执行脚本")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" /usr/local/sbin/lvs_dr.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"在2台rs服务器上操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在2台rs服务器上操作"}},[s._v("#")]),s._v(" 在2台RS服务器上操作")]),s._v(" "),t("p",[s._v("编辑脚本")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/sbin/lvs_dr_rs.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("lvs_dr_rs.sh")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#! /bin/bash")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vip")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.100\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" lo:0 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vip")]),s._v(" broadcast "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vip")]),s._v(" netmask "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.255 up\n\nroute "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" -host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vip")]),s._v(" lo:0\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/proc/sys/net/ipv4/conf/lo/arp_ignore\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/proc/sys/net/ipv4/conf/lo/arp_announce\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/proc/sys/net/ipv4/conf/all/arp_ignore\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/proc/sys/net/ipv4/conf/all/arp_announce\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("执行脚本")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" /usr/local/sbin/lvs_dr_rs.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),t("p",[s._v("在浏览器输入http://192.168.1.100/")]),s._v(" "),t("p",[s._v("如果stop掉node1的nginx，就会转发到node2的nginx")]),s._v(" "),t("p",[s._v("再次访问http://192.168.1.100/")])])}),[],!1,null,null,null);a.default=e.exports}}]);