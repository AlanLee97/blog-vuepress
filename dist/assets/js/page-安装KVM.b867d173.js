(window.webpackJsonp=window.webpackJsonp||[]).push([[228],{1042:function(s,a,n){"use strict";n.r(a);var t=n(1),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"安装kvm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装kvm"}},[s._v("#")]),s._v(" 安装KVM")]),s._v(" "),n("h5",{attrs:{id:"_1-cpu检测"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-cpu检测"}},[s._v("#")]),s._v(" 1. CPU检测")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("egrep")]),s._v(" -c "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(vmx|svm)'")]),s._v(" /proc/cpuinfo\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("命令结果大于0表示cpu支持虚拟化")]),s._v(" "),n("h5",{attrs:{id:"_2-安装命令kvm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装命令kvm"}},[s._v("#")]),s._v(" 2. 安装命令kvm")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y qemu-kvm\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h5",{attrs:{id:"_3-安装虚拟化管理工具"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装虚拟化管理工具"}},[s._v("#")]),s._v(" 3. 安装虚拟化管理工具")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y virt-manager libvirt libvirt-python python-virtinst bridge-utils\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("blockquote",[n("p",[s._v("libvirt：操作和管理KVM虚机的虚拟化 API，使用 C 语言编写，可以由 Python,Ruby, Perl, PHP, Java 等语言调用。可以操作包括 KVM，vmware，XEN，Hyper-v, LXC 等 Hypervisor。")]),s._v(" "),n("p",[s._v("Virsh：基于 libvirt 的 命令行工具 （CLI）")]),s._v(" "),n("p",[s._v("Virt-Manager：基于 libvirt 的 GUI 工具")])]),s._v(" "),n("h5",{attrs:{id:"_4-查看kvm-内核模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-查看kvm-内核模块"}},[s._v("#")]),s._v(" 4. 查看"),n("strong",[s._v("kvm")]),s._v(" 内核模块")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("lsmod "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" kvm\nmodprobe kvm\nmodprobe kvm-intel\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h5",{attrs:{id:"_5-查看libvirt"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-查看libvirt"}},[s._v("#")]),s._v(" 5. 查看libvirt")]),s._v(" "),n("p",[s._v("关闭防火墙")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" firewalld stop\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("开启libvirt")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" libvirtd restart\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" libvirtd on\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h5",{attrs:{id:"_6-创建虚拟机硬盘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-创建虚拟机硬盘"}},[s._v("#")]),s._v(" 6. 创建虚拟机硬盘")]),s._v(" "),n("p",[s._v("创建文件夹")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /kvmtest/centos7\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("创建安装盘")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("qemu-img create -f qcow2 /kvmtest/centos7/centos7.qcow2 10G\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("blockquote",[n("p",[s._v("默认网络配置文件")]),s._v(" "),n("p",[s._v("/etc/libvirt/qemu/networks")])]),s._v(" "),n("h5",{attrs:{id:"_7-创建虚拟机"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-创建虚拟机"}},[s._v("#")]),s._v(" 7. 创建虚拟机")]),s._v(" "),n("p",[s._v("下载centos，下载地址：http://mirrors.aliyun.com/centos/7.8.2003/isos/x86_64/")]),s._v(" "),n("p",[s._v("将iCentOS-7-x86_64-Minimal-2003.iso文件上传到服务器")]),s._v(" "),n("p",[s._v("创建虚拟机")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("virt-install --virt-type kvm --name centos7 --ram "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--vcpus "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--cdrom"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/kvmtest/centos7/CentOS-7-x86_64-Minimal-2003.iso "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--disk /kvmtest/centos7/centos7.qcow2,format"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("qcow2 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--network "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("network")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("default "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--graphics vnc,listen"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 --noautoconsole "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--os-type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("linux --os-variant"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("rhel6\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h5",{attrs:{id:"_8-连接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-连接"}},[s._v("#")]),s._v(" 8. 连接")]),s._v(" "),n("p",[s._v("查看端口")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -natp\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h5",{attrs:{id:"_9-使用vnc软件连接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-使用vnc软件连接"}},[s._v("#")]),s._v(" 9.使用vnc软件连接")]),s._v(" "),n("p",[s._v("点击ok之后出现centos的安装界面，自己手动安装即可")]),s._v(" "),n("p",[s._v("安装完之后重启")]),s._v(" "),n("h5",{attrs:{id:"_10-使用virsh"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-使用virsh"}},[s._v("#")]),s._v(" 10. 使用virsh")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("查看虚拟机")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("list --all\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("启动虚拟机")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("start centos7\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h5",{attrs:{id:"_11-打开vnc"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-打开vnc"}},[s._v("#")]),s._v(" 11. 打开VNC")]),s._v(" "),n("p",[s._v("此时已经启动安装的虚拟机了。")]),s._v(" "),n("h2",{attrs:{id:"配置桥接网络"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置桥接网络"}},[s._v("#")]),s._v(" 配置桥接网络")]),s._v(" "),n("blockquote",[n("p",[s._v("在宿主机上操作")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" ifcfg-ens33\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("内容如下")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("TYPE=Ethernet\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=static\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\nIPV6INIT=yes\nIPV6_AUTOCONF=yes\nIPV6_DEFROUTE=yes\nIPV6_FAILURE_FATAL=no\nIPV6_ADDR_GEN_MODE=stable-privacy\nNAME=ens33\nUUID=7adeb72e-13ae-47d8-8bc3-2f8e89701bad\nDEVICE=ens33\n# 添加网桥\nBRIDGE=br0\nONBOOT=yes\nIPADDR=192.168.0.30\nNETMASK=255.255.255.0\nGATEWAY=192.168.0.2\nDNS1=8.8.8.8\nDNS2=114.114.114.114\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("p",[s._v("将ifcfg-ens33复制一份文件，用来做网桥的配置文件")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" ifcfg-ens33 ifcfg-br0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("内容如下")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("TYPE=Bridge\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=static\nDEFROUTE=yes\nNAME=ens33\nDEVICE=br0\nONBOOT=yes\nIPADDR=192.168.0.30\nNETMASK=255.255.255.0\nGATEWAY=192.168.0.2\nDNS1=8.8.8.8\nDNS2=114.114.114.114\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("使用virsh")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("virsh")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("net-edit default\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("\nnet-define /etc/libvirt/qemu/networks/default.xml\n\nnet-destroy default\n\nnet-start default\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭重启（冷启动）")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v(" centos7\nstart centos7\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h2",{attrs:{id:"遇到的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#遇到的问题"}},[s._v("#")]),s._v(" 遇到的问题")]),s._v(" "),n("h3",{attrs:{id:"问题1"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问题1"}},[s._v("#")]),s._v(" 问题1")]),s._v(" "),n("p",[s._v("-bash: virt-install: command not found")]),s._v(" "),n("p",[s._v("安装")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y libguestfs-tools\n\nyum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y virt-install.noarch\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);